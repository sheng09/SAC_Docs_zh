\section{震相理论到时}
震相理论到时的计算是地震学的基础，具体的原理涉及到一大堆公式，感兴趣的读者可以阅读相关文献。

日常工作中经常需要识别震相、将波形按理论到时排序或迭加、计算震相到时残差等等，这些都需要用到震相理论到时，将震相理论到时写入到SAC文件的头段中，可以使得后期处理更加简单。

SAC头段中可以用于保存震相到时信息的头段包括：a、f以及tn（n=0-9），ka、kf和ktn中则用于保存相应的震相名信息。

给SAC文件标记理论到时有三种方法，下面一一介绍。

\subsection{手动标记}
最直观的办法是根据SAC文件中的震源深度和震中距信息用某些程序计算出理论到时，然后用~\nameref{cmd:chnhdr}~命令手动将到时信息写入到SAC头段中。

\begin{SACCode}
SAC> dg sub teleseis nykl.z     // 以nykl.z为例
SAC> lh evdp gcarc         // 查看震源深度和震中距

  FILE: /opt/sac/aux/datagen/teleseis/nykl.z - 1
   ------------------------------------------

     evdp = 0.000000e+00
    gcarc = 3.841450e+01
// 利用某程序计算得到ak135模型下，P波走时为443.14秒，S波走时为799.05秒
// 若SAC文件的参考时间为发震时刻，则
SAC> ch t0 443.14 t1 799.05 kt0 P kt1 S
SAC> lh t0 kt0 t1 kt1

    FILE: /opt/sac/aux/datagen/teleseis/nykl.z - 1
    ------------------------------------------

     t0 = 4.431400e+02
    kt0 = P
     t1 = 7.990500e+02
    kt1 = S
\end{SACCode}

该方法很直接也很基础， 其缺点也很明显，那就是麻烦。

\subsection{traveltime命令}
\nameref{cmd:traveltime}是SAC提供的一个命令，用于计算iasp91或者ak135地球模型下的震相理论走时，并自动将震相到时信息保存到SAC头段变量中。

\begin{SACCode}
SAC> dg sub teleseis nykl.z
SAC> traveltime model iasp91 picks 3 phase P S
traveltime: depth: 0.000000 km
SAC> lh t3 kt3 t4 kt4

  FILE: /opt/sac/aux/datagen/teleseis/nykl.z - 1
   ------------------------------------------

         t3 = 4.430530e+02
        kt3 = P
         t4 = 7.999642e+02
        kt4 = S
\end{SACCode}

该命令会将震相P、S的理论到时依次写入头段变量t3、t4中，并在相应的K头段中写入震相名信息。

该方法的优点在于是SAC内置命令，使用起来也很简单，缺点在于只支持两种地球速度模型。

\subsection{taup\_setsac命令}
\verb+taup_setsac+~是taup软件提供的用于计算震相理论到时的独立于SAC的外部命令。

\begin{minted}{console}
$ taup_setsac -mod prem -ph P-6,S-7 -evdpkm *.SAC
\end{minted}

该命令会根据SAC文件中的震中距和震源深度信息，计算P和S震相在PREM模型下的理论走时，并写入到SAC头段t6和t7中，同时向kt6和kt7中写入震相名称。

该方法的优点在于支持多种地球标准模型以及自定义模型。
